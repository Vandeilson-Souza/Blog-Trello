<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Trello - Painel de Posts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            500: '#6366f1',
                            600: '#5b21b6',
                            700: '#4c1d95',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'fade-in-up': 'fadeInUp 0.6s ease-out',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-slate-50 to-blue-100 min-h-screen text-gray-900">
    <!-- Navbar moderna -->
    <nav class="gradient-bg shadow-xl border-b border-white/10 sticky top-0 z-50 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="/" class="flex items-center space-x-2 text-white font-bold text-xl">
                    <i class="bi bi-kanban text-2xl"></i>
                    <span>Blog Trello</span>
                </a>
                <div class="flex space-x-3">
                    <button onclick="openIndependentCardModal()" class="flex items-center space-x-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/20 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg">
                        <i class="bi bi-plus-circle"></i>
                        <span>Criar Card</span>
                    </button>
                    <button onclick="refreshPosts()" class="flex items-center space-x-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/20 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg">
                        <i class="bi bi-arrow-clockwise"></i>
                        <span>Atualizar</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header com estatísticas -->
        <div class="gradient-card rounded-2xl p-8 mb-8 shadow-xl border border-gray-200 animate-fade-in-up">
            <h1 class="text-3xl font-bold text-center mb-6 text-gray-800 flex items-center justify-center">
                <i class="bi bi-graph-up mr-3 text-primary-500"></i>
                Dashboard de Conteúdo
            </h1>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="bg-white p-6 rounded-xl text-center shadow-md border border-gray-100 hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                    <span class="text-3xl font-bold text-primary-500 block">{{ total_posts }}</span>
                    <div class="text-gray-600 text-sm font-medium mt-2">Total de Posts</div>
                </div>
                <div class="bg-white p-6 rounded-xl text-center shadow-md border border-gray-100 hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                    <span class="text-3xl font-bold text-green-500 block">{{ total_updated }}</span>
                    <div class="text-gray-600 text-sm font-medium mt-2">Atualizados</div>
                </div>
                <div class="bg-white p-6 rounded-xl text-center shadow-md border border-gray-100 hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                    <span class="text-3xl font-bold text-yellow-500 block">{{ total_need_review }}</span>
                    <div class="text-gray-600 text-sm font-medium mt-2">Precisam Revisão</div>
                </div>
                <div class="bg-white p-6 rounded-xl text-center shadow-md border border-gray-100 hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                    <span class="text-3xl font-bold text-red-500 block">{{ total_never_reviewed }}</span>
                    <div class="text-gray-600 text-sm font-medium mt-2">Nunca Revisados</div>
                </div>
            </div>
        </div>

        <!-- Filtros modernos -->
        <div class="bg-white rounded-2xl p-6 mb-8 shadow-xl border border-gray-200 animate-fade-in">
            <form id="filterForm" method="GET" action="/">
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-search mr-1"></i>Buscar
                        </label>
                        <input type="text" id="searchInput" name="search" 
                               placeholder="Digite o título do post..." 
                               value="{{ request.args.get('search', '') }}"
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-building mr-1"></i>Fonte
                        </label>
                        <select id="sourceFilter" name="source" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                            <option value="">Todas as fontes</option>
                            {% for source in sources %}
                            <option value="{{ source }}" {% if request.args.get('source') == source %}selected{% endif %}>
                                {{ source }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-tag mr-1"></i>Categoria
                        </label>
                        <select id="categoryFilter" name="category" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                            <option value="">Todas as categorias</option>
                            {% for category in categories %}
                            <option value="{{ category }}" {% if request.args.get('category') == category %}selected{% endif %}>
                                {{ category }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-flag mr-1"></i>Status
                        </label>
                        <select id="statusFilter" name="status" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                            <option value="">Todos os status</option>
                            <option value="never" {% if request.args.get('status') == 'never' %}selected{% endif %}>
                                Nunca revisado
                            </option>
                            <option value="recent" {% if request.args.get('status') == 'recent' %}selected{% endif %}>
                                Atualizado
                            </option>
                            <option value="old" {% if request.args.get('status') == 'old' %}selected{% endif %}>
                                Precisa revisão
                            </option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-grid mr-1"></i>Por página
                        </label>
                        <select id="perPageFilter" name="per_page" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                            <option value="6" {% if request.args.get('per_page') == '6' %}selected{% endif %}>6 posts</option>
                            <option value="12" {% if request.args.get('per_page') == '12' or not request.args.get('per_page') %}selected{% endif %}>12 posts</option>
                            <option value="24" {% if request.args.get('per_page') == '24' %}selected{% endif %}>24 posts</option>
                            <option value="48" {% if request.args.get('per_page') == '48' %}selected{% endif %}>48 posts</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button type="submit" class="w-full bg-primary-500 hover:bg-primary-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg flex items-center justify-center">
                            <i class="bi bi-funnel mr-2"></i>Filtrar
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Resumo de resultados -->
        {% if pagination %}
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
            <div class="text-gray-600 mb-3 sm:mb-0">
                <span class="text-sm">
                    Mostrando <span class="font-semibold text-gray-900">{{ (pagination.page - 1) * pagination.per_page + 1 }}</span>
                    a <span class="font-semibold text-gray-900">{{ pagination.page * pagination.per_page if pagination.page * pagination.per_page < pagination.total else pagination.total }}</span>
                    de <span class="font-semibold text-gray-900">{{ pagination.total }}</span> posts
                </span>
            </div>
            
            {% if pagination.pages > 1 %}
            <div class="text-sm text-gray-500">
                Página <span class="font-semibold text-primary-600">{{ pagination.page }}</span> de {{ pagination.pages }}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Grid de posts -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 animate-fade-in" id="postsContainer">
            {% for post in posts %}
            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-2 relative group" 
                 data-title="{{ post.title|lower }}"
                 data-category="{{ post.category }}"
                 data-status="{{ 'sent' if post.trello_card_id else 'pending' }}">
                
                <!-- Barra colorida superior -->
                <div class="h-1 gradient-bg"></div>
                
                <div class="p-6">
                    <h5 class="text-lg font-semibold text-gray-800 mb-3 line-clamp-2 group-hover:text-primary-600 transition-colors duration-300">
                        <a href="{{ post.url }}" target="_blank" class="hover:text-primary-600">{{ post.title }}</a>
                    </h5>
                    
                    <div class="flex items-center text-gray-500 text-sm mb-4">
                        <i class="bi bi-calendar3 mr-2"></i>
                        <span>{{ post.updated_at.strftime('%d/%m/%Y às %H:%M') }}</span>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">
                            <i class="bi bi-building mr-1"></i>{{ post.source }}
                        </span>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">
                            <i class="bi bi-folder mr-1"></i>{{ post.category }}
                        </span>
                        
                        {% if post.trello_card_id %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">
                            <i class="bi bi-check-circle mr-1"></i>Enviado para Trello
                        </span>
                        {% endif %}
                        
                        {% if post.review_status == 'never' %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700">
                            <i class="bi bi-exclamation-triangle mr-1"></i>Nunca revisado
                        </span>
                        {% elif post.review_status == 'recent' %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">
                            <i class="bi bi-check2-circle mr-1"></i>Atualizado
                        </span>
                        {% elif post.review_status == 'old' %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700">
                            <i class="bi bi-clock-history mr-1"></i>Precisa revisão
                        </span>
                        {% endif %}
                    </div>

                    {% if post.last_review_date %}
                    <div class="flex items-center text-gray-500 text-sm mb-4">
                        <i class="bi bi-clock-history mr-2"></i>
                        <span>Última revisão: {{ post.last_review_date.strftime('%d/%m/%Y') }}</span>
                    </div>
                    {% endif %}

                    {% if post.review_status == 'never' %}
                    <div class="flex items-center space-x-2">
                        <button onclick="markPostAsUpdated('{{ post.id }}')" class="flex items-center space-x-1 text-gray-600 hover:text-primary-500 transition-colors duration-200">
                            <i class="bi bi-check-circle"></i>
                            <span class="text-sm">Marcar como Atualizado</span>
                        </button>
                    </div>
                    {% endif %}

                    <button data-post-id="{{ post.id }}" data-post-title="{{ post.title }}" data-post-url="{{ post.url }}" onclick="openTrelloModal(this)" 
                            class="w-full bg-primary-500 hover:bg-primary-600 text-white px-4 py-3 rounded-xl font-medium transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg flex items-center justify-center">
                        <i class="bi bi-trello mr-2"></i>Criar Tarefa no Trello
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Paginação melhorada -->
        {% if pagination and pagination.pages > 1 %}
        <div class="mt-12 bg-white rounded-2xl p-6 shadow-xl border border-gray-200">
            <!-- Informações sobre resultados -->
            <div class="text-center mb-6">
                <p class="text-sm text-gray-600">
                    Mostrando 
                    <span class="font-semibold text-gray-900">{{ (pagination.page - 1) * pagination.per_page + 1 }}</span>
                    até 
                    <span class="font-semibold text-gray-900">{{ pagination.page * pagination.per_page if pagination.page * pagination.per_page < pagination.total else pagination.total }}</span>
                    de 
                    <span class="font-semibold text-gray-900">{{ pagination.total }}</span>
                    resultados
                </p>
            </div>
            
            <!-- Navegação da paginação -->
            <nav aria-label="Navegação de páginas">
                <ul class="flex flex-wrap justify-center items-center space-x-1 sm:space-x-2">
                    <!-- Primeira página -->
                    {% if pagination.page > 3 %}
                    <li>
                        <a href="{{ url_for('index', page=1, **dict(request.args.items()|selectattr('0', 'ne', 'page')|list)) }}" 
                           class="hidden sm:flex items-center px-3 py-2 text-sm text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-all duration-300">
                            1
                        </a>
                    </li>
                    {% if pagination.page > 4 %}
                    <li>
                        <span class="hidden sm:block px-2 py-2 text-gray-400 text-sm">...</span>
                    </li>
                    {% endif %}
                    {% endif %}

                    <!-- Página anterior -->
                    {% if pagination.has_prev %}
                    <li>
                        <a href="{{ url_for('index', page=pagination.prev_num, **dict(request.args.items()|selectattr('0', 'ne', 'page')|list)) }}" 
                           class="flex items-center px-3 py-2 text-sm text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-all duration-300">
                            <i class="bi bi-chevron-left mr-1"></i>
                            <span class="hidden sm:inline">Anterior</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Páginas do meio -->
                    {% for page in pagination.iter_pages(left_edge=0, right_edge=0, left_current=2, right_current=2) %}
                        {% if page %}
                            <li>
                                <a href="{{ url_for('index', page=page, **dict(request.args.items()|selectattr('0', 'ne', 'page')|list)) }}" 
                                   class="flex items-center px-3 py-2 text-sm border rounded-lg transition-all duration-300 {% if page == pagination.page %}bg-primary-500 text-white border-primary-500 font-semibold{% else %}text-primary-600 border-primary-200 hover:bg-primary-50{% endif %}">
                                    {{ page }}
                                </a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    <!-- Próxima página -->
                    {% if pagination.has_next %}
                    <li>
                        <a href="{{ url_for('index', page=pagination.next_num, **dict(request.args.items()|selectattr('0', 'ne', 'page')|list)) }}" 
                           class="flex items-center px-3 py-2 text-sm text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-all duration-300">
                            <span class="hidden sm:inline">Próximo</span>
                            <i class="bi bi-chevron-right ml-1"></i>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Última página -->
                    {% if pagination.page < pagination.pages - 2 %}
                    {% if pagination.page < pagination.pages - 3 %}
                    <li>
                        <span class="hidden sm:block px-2 py-2 text-gray-400 text-sm">...</span>
                    </li>
                    {% endif %}
                    <li>
                        <a href="{{ url_for('index', page=pagination.pages, **dict(request.args.items()|selectattr('0', 'ne', 'page')|list)) }}" 
                           class="hidden sm:flex items-center px-3 py-2 text-sm text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-all duration-300">
                            {{ pagination.pages }}
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            
            <!-- Navegação rápida para página específica -->
            {% if pagination.pages > 5 %}
            <div class="mt-6 flex justify-center items-center space-x-3">
                <label for="quickPageNav" class="text-sm text-gray-600 font-medium">Ir para página:</label>
                <input type="number" id="quickPageNav" min="1" max="{{ pagination.pages }}" 
                       placeholder="{{ pagination.page }}"
                       class="w-20 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-100 transition-all duration-300">
                <button onclick="goToPage()" class="px-4 py-2 bg-primary-500 text-white text-sm rounded-lg hover:bg-primary-600 transition-all duration-300">
                    Ir
                </button>
            </div>
            {% endif %}
            
            <!-- Paginação rápida para mobile -->
            <div class="mt-4 sm:hidden">
                <div class="flex justify-between items-center">
                    {% if pagination.has_prev %}
                    <a href="{{ url_for('index', page=pagination.prev_num, **dict(request.args.items()|selectattr('0', 'ne', 'page')|list)) }}" 
                       class="flex items-center px-4 py-2 text-sm bg-primary-500 text-white rounded-lg font-medium">
                        <i class="bi bi-chevron-left mr-1"></i> Anterior
                    </a>
                    {% else %}
                    <div></div>
                    {% endif %}
                    
                    <span class="text-sm text-gray-600 font-medium">
                        {{ pagination.page }} de {{ pagination.pages }}
                    </span>
                    
                    {% if pagination.has_next %}
                    <a href="{{ url_for('index', page=pagination.next_num, **dict(request.args.items()|selectattr('0', 'ne', 'page')|list)) }}" 
                       class="flex items-center px-4 py-2 text-sm bg-primary-500 text-white rounded-lg font-medium">
                        Próximo <i class="bi bi-chevron-right ml-1"></i>
                    </a>
                    {% else %}
                    <div></div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Modal do Trello moderno -->
    <div id="trelloModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl border border-gray-200 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="gradient-bg p-6 rounded-t-2xl">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white flex items-center">
                        <i class="bi bi-trello mr-3"></i>Criar Tarefa no Trello
                    </h3>
                    <button onclick="closeTrelloModal()" class="text-white hover:text-gray-200 transition-colors duration-200">
                        <i class="bi bi-x-lg text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="trelloForm">
                    <input type="hidden" id="postId">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-card-text mr-1"></i>Nome da Tarefa
                            </label>
                            <input type="text" id="taskName" readonly 
                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-gray-50 text-gray-900">
                        </div>
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-link-45deg mr-1"></i>Link do Blog
                            </label>
                            <input type="url" id="blogUrl" readonly 
                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-gray-50 text-gray-900">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-person mr-1"></i>Responsável
                            </label>
                            <select id="assignee" required 
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                                <option value="">Selecione um responsável</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-calendar-event mr-1"></i>Prazo
                            </label>
                            <input type="text" id="dueDate" required 
                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                        </div>
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-tags mr-1"></i>Etiquetas
                            </label>
                            <select id="labels" multiple 
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                            </select>
                        </div>
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-chat-text mr-1"></i>Descrição/Comentários
                            </label>
                            <textarea id="description" rows="4" placeholder="Adicione detalhes sobre a tarefa..."
                                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900 resize-none"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="flex justify-end space-x-3 px-6 pb-6 border-t border-gray-200 pt-6">
                <button onclick="closeTrelloModal()" 
                        class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-all duration-300 flex items-center">
                    <i class="bi bi-x-circle mr-2"></i>Cancelar
                </button>
                <button onclick="createTrelloCard()" id="submitButton"
                        class="px-6 py-3 bg-primary-500 hover:bg-primary-600 text-white rounded-xl font-medium transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg flex items-center">
                    <i class="bi bi-send mr-2"></i>Enviar para Trello
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Card Independente -->
    <div id="independentCardModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl border border-gray-200 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="gradient-bg p-6 rounded-t-2xl">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white flex items-center">
                        <i class="bi bi-plus-circle mr-3"></i>Criar Card no Trello
                    </h3>
                    <button onclick="closeIndependentCardModal()" class="text-white hover:text-gray-200 transition-colors duration-200">
                        <i class="bi bi-x-lg text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="independentCardForm">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-bookmark mr-1"></i>Tipo de Card
                            </label>
                            <select id="cardType" required 
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                                <option value="">Selecione o tipo</option>
                                <option value="post">Criação de Post</option>
                                <option value="tutorial">Criação de Tutorial</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-person mr-1"></i>Responsável
                            </label>
                            <select id="cardAssignee" required 
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                                <option value="">Selecione um responsável</option>
                            </select>
                        </div>
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-card-heading mr-1"></i>Título
                            </label>
                            <input type="text" id="cardTitle" required placeholder="Digite o título do card..."
                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                        </div>
                        <div class="lg:col-span-1">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-link-45deg mr-1"></i>Link (opcional)
                            </label>
                            <input type="url" id="cardLink" placeholder="https://exemplo.com"
                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                        </div>
                        <div class="lg:col-span-1">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-calendar-event mr-1"></i>Prazo
                            </label>
                            <input type="text" id="cardDueDate" required 
                                   class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900">
                        </div>
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-chat-text mr-1"></i>Descrição/Comentários
                            </label>
                            <textarea id="cardDescription" rows="4" placeholder="Adicione detalhes sobre o card..."
                                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-4 focus:ring-primary-100 transition-all duration-300 text-gray-900 resize-none"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="flex justify-end space-x-3 px-6 pb-6 border-t border-gray-200 pt-6">
                <button onclick="closeIndependentCardModal()" 
                        class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-all duration-300 flex items-center">
                    <i class="bi bi-x-circle mr-2"></i>Cancelar
                </button>
                <button onclick="createIndependentCard()" id="submitIndependentCard"
                        class="px-6 py-3 bg-primary-500 hover:bg-primary-600 text-white rounded-xl font-medium transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg flex items-center">
                    <i class="bi bi-plus-circle mr-2"></i>Criar Card
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Alerta moderno -->
    <div id="alertModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl border border-gray-200 w-full max-w-md mx-4">
            <div class="p-6 text-center">
                <div class="mb-4">
                    <i id="alertIcon" class="text-6xl"></i>
                </div>
                <h3 id="alertTitle" class="text-xl font-semibold text-gray-800 mb-2">Notificação</h3>
                <p id="alertMessage" class="text-gray-600 mb-6"></p>
                <button onclick="closeAlertModal()" 
                        class="px-6 py-3 bg-primary-500 hover:bg-primary-600 text-white rounded-xl font-medium transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg flex items-center justify-center mx-auto">
                    <i class="bi bi-check mr-2"></i>Entendi
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 backdrop-blur-sm">
        <div class="w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
    </div>

    <script>
        // Variáveis globais do template
        const PAGINATION_PAGES = {% if pagination %}{{ pagination.pages }}{% else %}1{% endif %};
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>
    <script>
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializa os date pickers
            flatpickr("#dueDate", {
                locale: "pt",
                dateFormat: "Y-m-d",
                minDate: "today",
                theme: "material_blue"
            });

            flatpickr("#cardDueDate", {
                locale: "pt",
                dateFormat: "Y-m-d",
                minDate: "today",
                theme: "material_blue"
            });

            // Adiciona animação aos cards
            const cards = document.querySelectorAll('.group');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('animate-fade-in');
                }, index * 100);
            });

            // Event listener para navegação rápida com Enter
            const quickPageNav = document.getElementById('quickPageNav');
            if (quickPageNav) {
                quickPageNav.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        goToPage();
                    }
                });
            }
        });

        // Formulário de filtros
        document.getElementById('filterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const params = new URLSearchParams(formData);
            window.location.href = '/?' + params.toString();
        });

        // Funções para modais
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function closeTrelloModal() {
            hideModal('trelloModal');
        }

        function closeIndependentCardModal() {
            hideModal('independentCardModal');
        }

        function closeAlertModal() {
            hideModal('alertModal');
        }

        // Função para mostrar alertas
        function showAlert(title, message, type = 'success') {
            const alertTitle = document.getElementById('alertTitle');
            const alertMessage = document.getElementById('alertMessage');
            const alertIcon = document.getElementById('alertIcon');

            if (type === 'success') {
                alertIcon.className = 'bi bi-check-circle-fill text-green-500 text-6xl';
                alertTitle.textContent = 'Sucesso!';
            } else if (type === 'error') {
                alertIcon.className = 'bi bi-exclamation-circle-fill text-red-500 text-6xl';
                alertTitle.textContent = 'Erro!';
            } else if (type === 'warning') {
                alertIcon.className = 'bi bi-exclamation-triangle-fill text-yellow-500 text-6xl';
                alertTitle.textContent = 'Atenção!';
            }

            alertMessage.textContent = message;
            showModal('alertModal');
        }

        // Função para mostrar loading
        function showLoading() {
            showModal('loadingOverlay');
        }

        function hideLoading() {
            hideModal('loadingOverlay');
        }

        // Abrir modal do Trello
        function openTrelloModal(button) {
            showLoading();
            
            const postId = button.getAttribute('data-post-id');
            const postTitle = button.getAttribute('data-post-title');
            const postUrl = button.getAttribute('data-post-url');
            
            document.getElementById('postId').value = postId;
            document.getElementById('taskName').value = `Revisar post: ${postTitle}`;
            document.getElementById('blogUrl').value = postUrl;
            
            fetch('/get_trello_members')
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        const assigneeSelect = document.getElementById('assignee');
                        assigneeSelect.innerHTML = '<option value="">Selecione um responsável</option>';
                        data.members.forEach(member => {
                            const option = document.createElement('option');
                            option.value = member.id;
                            option.textContent = `${member.name} (${member.username})`;
                            assigneeSelect.appendChild(option);
                        });
                        
                        showModal('trelloModal');
                    } else {
                        showAlert('Erro', 'Erro ao carregar membros: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showAlert('Erro', 'Erro ao carregar membros: ' + error, 'error');
                });
        }

        // Criar card no Trello
        function createTrelloCard() {
            const data = {
                post_id: document.getElementById('postId').value,
                assignee: document.getElementById('assignee').value,
                due_date: document.getElementById('dueDate').value,
                labels: Array.from(document.getElementById('labels').selectedOptions).map(opt => opt.value),
                description: document.getElementById('description').value
            };

            showLoading();

            fetch('/create_trello_card', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    hideModal('trelloModal');
                    showAlert('Sucesso', 'Card criado com sucesso no Trello!', 'success');
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showAlert('Erro', 'Erro ao criar card: ' + data.error, 'error');
                }
            })
            .catch(error => {
                hideLoading();
                showAlert('Erro', 'Erro ao criar card: ' + error, 'error');
            });
        }

        // Abrir modal de card independente
        function openIndependentCardModal() {
            showLoading();
            
            fetch('/get_trello_members')
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        const assigneeSelect = document.getElementById('cardAssignee');
                        assigneeSelect.innerHTML = '<option value="">Selecione um responsável</option>';
                        data.members.forEach(member => {
                            const option = document.createElement('option');
                            option.value = member.id;
                            option.textContent = `${member.name} (${member.username})`;
                            assigneeSelect.appendChild(option);
                        });
                        
                        showModal('independentCardModal');
                    } else {
                        showAlert('Erro', 'Erro ao carregar membros: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showAlert('Erro', 'Erro ao carregar membros: ' + error, 'error');
                });
        }

        // Criar card independente
        function createIndependentCard() {
            const cardType = document.getElementById('cardType').value;
            const title = document.getElementById('cardTitle').value;
            const link = document.getElementById('cardLink').value;
            const assignee = document.getElementById('cardAssignee').value;
            const dueDate = document.getElementById('cardDueDate').value;
            const description = document.getElementById('cardDescription').value;

            if (!cardType || !title || !assignee || !dueDate) {
                showAlert('Atenção', 'Por favor, preencha todos os campos obrigatórios.', 'warning');
                return;
            }
            
            const data = {
                card_type: cardType,
                title: title,
                link: link,
                assignee: assignee,
                due_date: dueDate,
                description: description
            };

            showLoading();

            fetch('/create_independent_card', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    hideModal('independentCardModal');
                    showAlert('Sucesso', 'Card criado com sucesso no Trello!', 'success');
                    
                    // Limpa o formulário
                    document.getElementById('independentCardForm').reset();
                } else {
                    showAlert('Erro', 'Erro ao criar card: ' + data.error, 'error');
                }
            })
            .catch(error => {
                hideLoading();
                showAlert('Erro', 'Erro ao criar card: ' + error, 'error');
            });
        }

        // Atualizar posts
        function refreshPosts() {
            showLoading();
            
            fetch('/refresh_posts')
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showAlert('Sucesso', 'Posts atualizados com sucesso!', 'success');
                        setTimeout(() => {
                            location.reload();
                        }, 1500);
                    } else {
                        showAlert('Erro', 'Erro ao atualizar posts', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showAlert('Erro', 'Erro ao atualizar posts: ' + error, 'error');
                });
        }

        // Navegação rápida para página específica
        function goToPage() {
            const pageNumber = document.getElementById('quickPageNav').value;
            const maxPages = PAGINATION_PAGES;
            
            if (pageNumber && pageNumber >= 1 && pageNumber <= maxPages) {
                const currentUrl = new URL(window.location);
                currentUrl.searchParams.set('page', pageNumber);
                window.location.href = currentUrl.toString();
            } else {
                showAlert('Atenção', 'Por favor, digite um número de página válido (1-' + maxPages + ').', 'warning');
            }
        }

        // Fechar modais ao clicar fora
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('bg-black/50')) {
                if (e.target.id === 'trelloModal') closeTrelloModal();
                if (e.target.id === 'independentCardModal') closeIndependentCardModal();
                if (e.target.id === 'alertModal') closeAlertModal();
            }
        });

        // Função para marcar post como atualizado
        function markPostAsUpdated(postId) {
            if (confirm('Deseja marcar este post como atualizado?')) {
                showLoading();
                
                fetch('/mark_post_updated', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ post_id: postId })
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showAlert('Sucesso', 'Post marcado como atualizado!', 'success');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        showAlert('Erro', 'Erro ao atualizar post: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showAlert('Erro', 'Erro ao atualizar post: ' + error, 'error');
                });
            }
        }
    </script>
</body>
</html> 